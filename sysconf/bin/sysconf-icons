#!/bin/bash --posix

##
##  Goal:   semi-automate system configuration of icons for KDE favourites
##
##  Use:    source sysconf-icons
##
##  NB:     The caller must source functions etc à la sysconf script.
##

# do it

function iconsConf
{
    case "$1" in
      (30 | icons)
        listOptions 30 icons;
        quit;
        ;;

      (30.1 | iconsMythtv)
        step="30.1 iconsMythtv";
        note "Install icon desktop files for mythtv ...";

        if [[ -e /usr/share/applications/mythtv.desktop ]]; then
            DoOrDie InstallOurOwn /usr/share/applications/mythtv.desktop;
        fi
        if [[ -e /usr/share/applications/mythtv-setup.desktop ]]; then
            DoOrDie InstallOurOwn /usr/share/applications/mythtv-setup.desktop;
        fi
        ;;

      (30.2 | iconsEclipse)
        step="30.2 iconsEclipse";
        note "Install icons for eclipse ...";

        local path file size dir;
        for path in $(find /opt/eclipse/plugins/org.eclipse.platform_*/ -name eclipse*.png); do
            file="${path##*/}";
            size="${file%.png}";
            size="${size#eclipse}";
            dir="/usr/share/icons/hicolor/${size}x${size}";
            if [[ -e ${dir} ]]; then
                DoOrDie sudo ln -sf "${path}" "${dir}/apps/eclipse.png";
            fi
        done

        DoOrDie InstallOurOwn /usr/share/applications/eclipse.desktop;
        ;;

      (30.3 | iconsWindows)
        step="30.3 iconsWindows";
        note "Install icons for Windows™ guest machines ...";

        DoOrDie sudo rsync -ax /media/share/linux/sysconf/usr/share/icons/hicolor/ /usr/share/icons/hicolor/;

        DoOrDie FetchOurOwn /usr/share/applications/wpoX3.desktop.sh;
        cd keep/usr/share/applications > /dev/null;
            DoOrDie ./wpoX3.desktop.sh > wpoX3.desktop;
            DoOrDie sudo cp -p wpoX3.desktop /usr/share/applications;
        cd - > /dev/null;
        ;;

      (30.99)
        step="30.99 sanityCheck";
        note "Checking icons ...";
        ListLoggedSteps ${1%.*} | while read step name status; do
            echo -e $step $name $status;
            case "$step $name" in
              ("30.1 iconsMythtv")
                CheckOurOwn /usr/share/applications/mythtv.desktop;
                CheckOurOwn --opt /usr/share/applications/mythtv-setup.desktop;
                ;;
              ("30.2 iconsEclipse")
                CheckOurOwn /usr/share/applications/eclipse.desktop;
                ;;
              ("30.3 iconsWindows")
                CheckOurOwn /usr/share/applications/wpoX3.desktop;
                ;;
            esac
        done
        quit;
        ;;

      (*)
        badOption "$1";
        listOptions 30 icons;
        quit 1;
        ;;
    esac
}

### Local Variables: ***
### mode:ksh ***
### End: ***
