#!/bin/bash --posix

##
##  Goal:   semi-automate system configuration of applications
##
##  Use:    source sysconf-lang
##
##  NB:     The caller must source functions etc Ã  la sysconf script.
##

function defineSteps
{
    local major="$1"; shift;
    local minor=0;

    minor=$((minor+1));
    buildEssential=$major.$minor;

    minor=$((minor+1));
    langPython3=$major.$minor;
    pythonModule=$major.$minor.M;
}

function langConf
{
    local major="$1"; shift;
    defineSteps $major;

    local module="$2";

    case "$1" in
      ($major | build | lang)
        listOptions sysconf-lang "$1";
        quit;
        ;;

      ($buildEssential | buildEssential)
        step="$buildEssential buildEssential";
        note "Install C/C++ compiler and man pages 2 & 3";

        installPackage manpages-dev build-essential ccache;
        ;;

      ($langPython3 | langPython3)
        step="$langPython3 langPython3";
        note "Install Python 3 essentials";

        installPackage python3 python3-doc python3-pip;

        note "$(python --version 2>&1) installed";
        note "... documentation installed";
        note "... module installer (pip) installed";
        note "... pydoc  - already installed";
        note "... pylint - suggest sysconf pythonModule pylint";
        note "... pyunit - already installed";
        ;;

      ($pythonModule | pythonModule)
        case "${module,,}" in
          (pydoc)
            note "pydoc already installed - use pydoc3 from the command line";
            quit;
            ;;
          (pyunit)
            note "pyunit already installed - use import unittest in test modules";
            quit;
            ;;
        esac

        step="$pythonModule pythonModule:${module}";
        note "Install Python 3 module ${module}";

        DoOrDie sudo pip3 install ${module};
        ;;

      ($major.99)
        step="$major.99 sanityCheck";
        note "Checking apps ...";
        listLoggedSteps $major | while read step name status; do
            printf "%-7s %-23s %s\n" $step $name $status;
            case "$installDist $name" in
              (*buildEssential)
                CheckCurrent /etc/{passwd,group};
                ;;
              (*lang*)
                CheckCurrent /etc/{passwd,group};
                ;;
              (*Module:*)
                ;;
            esac
        done
        quit;
        ;;

      (*)
        badOption "$1";
        listOptions sysconf-lang $major;
        quit 1;
        ;;
    esac
}

### Local Variables: ***
### mode:ksh ***
### End: ***
