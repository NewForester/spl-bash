#!/bin/bash --posix

##
##  Goal:   semi-automate user configuration of libre office
##
##  Use:    source usrconf-office
##
##          officeConf step [version]
##
##  where [version] defaults to 3 but can be given as 4
##
##  NB:     The caller must source functions etc Ã  la usrconf script.
##

function defineSteps
{
    local major="$1"; shift;
    local minor=0;

    minor=$((minor+1));
    officePresets=$major.$minor;

    minor=$((minor+1));
    officeScripts=$major.$minor;

    minor=$((minor+1));
    officeAddins=$major.$minor;

    minor=$((minor+1));
    officeUserData=$major.$minor;
}

function officeConf
{
    local ourPython=/media/share/python/pbr;
    local userConfig=.config/libreoffice/${2-3}/user;

    local major="$1"; shift;
    defineSteps $major;

    case "$1" in
      ($major | office)
        listOptions usrconf-office "$1";
        quit;
        ;;

      ($officePresets | officePresets)
        step="$officePresets.${2-3} officePresets";
        note "Copy LibreOffice presets directory ...";

        DoOrDie mkdir -m 700 -p .config;
        DoOrDie mkdir -p "${userConfig}";

        local dir;
        for dir in /usr/lib/libreoffice/presets/*; do
            DoOrDie cp -pR "${dir}" "${userConfig}";
        done
        ;;

      ($officeScripts | officeScripts)
        step="$officeScripts.${2-3} officeScripts";
        note "Install Python scripts for LibreOffice ...";

        local scriptDir="${userConfig}/Scripts";

        DoOrDie mkdir -m 700 -p .config;
        DoOrDie mkdir -p "${scriptDir}";

        DoOrDie rm -f "${scriptDir}/python";
        DoOrDie ln -sf "${ourPython}/liboff/calc/macros/" "${scriptDir}/python";
        ;;

      ($officeAddins | officeAddins)
        step="$officeAddins.${2-3} officeAddins";
        note "Install Add-In Functions for Calc ...";

        local addinDir="${userConfig}/uno_packages/cache";

        DoOrDie mkdir -m 700 -p .config;
        DoOrDie mkdir -p "${addinDir}";

        if [[ "${2-3}" == "3" ]]; then
            addinList="ColumnLetters2.oxt PageName.oxt";
        else
            addinList="ColumnLetters3.oxt PageName.oxt";
        fi

        local addin;
        for addin in ${addinList}; do
            DoOrDieLocal liboaddon install "${ourPython}/liboff/calc/addins/${addin}";
        done
        ;;

      ($officeUserData | officeUserData)
        step="$officeUserData.${2-3} officeUserData";
        note "Install User Settings ...";

        DoOrDie mkdir -m 700 -p .config;
        DoOrDie mkdir -p "${userConfig}";

        DoOrDie cp -pR "${installUser}/${userConfig}"/* "${userConfig}";
        ;;

      ($major.99)
        step="$major.99 sanityCheck";
        note "Checking office ...";
        listLoggedSteps $major | while read step name status; do
            printf "%-7s %-23s %s\n" $step $name $status;
            case "$installDist $name" in
              (*)
                ;;
            esac
        done
        quit;
        ;;

      (*)
        badOption "$1";
        listOptions usrconf-office $major;
        quit 1;
        ;;
    esac
}

### Local Variables: ***
### mode:ksh ***
### End: ***
