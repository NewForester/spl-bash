#!/bin/bash --posix

##
##  Goal:   semi-automate user configuration of libre office
##
##  Use:    source usrconf-office
##
##          officeConf step [version]
##
##  where [version] defaults to 3 but can be given as 4
##
##  NB:     The caller must source functions etc Ã  la usrconf script.
##

# do it

function officeConf
{
    local ourPython=/media/share/python/pbr;
    local userConfig=.config/libreoffice/${2-3}/user;

    case "$1" in
      (10 | office)
        listOptions 10 office;
        quit;
        ;;

      (10.1 | officePresets)
        step="10.1.${2-3} officePresets";
        note "Copy LibreOffice presets directory ...";

        DoOrDie mkdir -m 700 -p .config;
        DoOrDie mkdir -p "${userConfig}";

        local dir;
        for dir in /usr/lib/libreoffice/presets/*; do
            DoOrDie cp -pR "${dir}" "${userConfig}";
        done
        ;;

      (10.2 | officeScripts)
        step="10.2.${2-3} officeScripts";
        note "Install Python scripts for LibreOffice ...";

        local scriptDir="${userConfig}/Scripts";

        DoOrDie mkdir -m 700 -p .config;
        DoOrDie mkdir -p "${scriptDir}";

        DoOrDie rm -f "${scriptDir}/python";
        DoOrDie ln -sf "${ourPython}/liboff/calc/macros/" "${scriptDir}/python";
        ;;

      (10.3 | officeAddins)
        step="10.3.${2-3} officeAddins";
        note "Install Add-In Functions for Calc ...";

        local addinDir="${userConfig}/uno_packages/cache";

        DoOrDie mkdir -m 700 -p .config;
        DoOrDie mkdir -p "${addinDir}";

        if [[ "${2-3}" == "3" ]]; then
            addinList="ColumnLetters2.oxt PageName.oxt";
        else
            addinList="ColumnLetters3.oxt PageName.oxt";
        fi

        local addin;
        for addin in ${addinList}; do
            DoOrDieLocal liboaddon install "${ourPython}/liboff/calc/addins/${addin}";
        done
        ;;

      (10.4 | officeUserData)
        step="10.4.${2-3} officeUserData";
        note "Install User Settings ...";

        DoOrDie mkdir -m 700 -p .config;
        DoOrDie mkdir -p "${userConfig}";

        DoOrDie cp -pR "${installUser}/${userConfig}"/* "${userConfig}";
        ;;

      (*)
        badOption "$1";
        listOptions 10 office;
        quit 1;
        ;;
    esac
}

### Local Variables: ***
### mode:ksh ***
### End: ***
